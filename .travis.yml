# Copyright (c) 2018 Shapelets.io
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

language: cpp
compiler: g++
sudo: required

env:
  global:
    - ARRAYFIRE=/opt/arrayfire

matrix:
  include:
    # works on Precise and Trusty
    - os: linux
      dist: trusty
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-4.9
            - lcov
            - python3
            - python3-pip
            - libboost-all-dev
            - doxygen
            - graphviz
      env:
         - MATRIX_EVAL="CC=gcc-4.9 && CXX=g++-4.9"

    # works on Precise and Trusty
    - os: linux
      dist: trusty
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-5
            - lcov
            - python3
            - python3-pip
            - libboost-all-dev
            - doxygen
            - graphviz
      env:
         - MATRIX_EVAL="CC=gcc-5 && CXX=g++-5"

cache:
    directories:
      - ${HOME}/.conan

before_install:
  - source .CI/travis/install-intel.sh 2>&1 > /dev/null
  - source .CI/travis/install-arrayfire.sh 2>&1 > /dev/null
  - source .CI/travis/install-cmake.sh 2>&1 > /dev/null
  - source .CI/travis/install.sh 2>&1 > /dev/null


install:
  - cd ..
  - git clone https://github.com/shapelets/khiva.git
  - cd khiva && git fetch --tags
  - git checkout tags/v0.1.0
  - mkdir build
  - cd build
  - conan remote add conan-mpusz https://api.bintray.com/conan/mpusz/conan-mpusz
  - cmake .. -DCMAKE_BUILD_TYPE=Release
  - make -j8 && make install
  - ldconfig
  - cd ../../khiva-python


script:
  - pip3 install -r requirements.txt
  - pip3 install -r test-requirements.txt
  - python3 setup.py install
  - python 3 tests/unit_tests/main_test.py
